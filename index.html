<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="theme-color" content="#0A0A1A">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ë¡œë˜ë³µë©ì´">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">
<meta name="google-site-verification" content="LFITFNrFrJ6R-iMzCu-XdMQZejgvfSi4EAxD9gqV-L4" />
<meta name="naver-site-verification" content="2dd2b2e4fb6ed1afc2330e25945385e8fb865644" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ€ ë¡œë˜ë³µë©ì´ - í–‰ìš´ì˜ ë²ˆí˜¸ë¥¼ ì°¾ì•„ì„œ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #FFD700;
    --gold-light: #FFF0A0;
    --deep: #0A0A1A;
    --navy: #0D1B3E;
    --accent: #FF6B35;
    --green: #00E676;
    --text: #E8E8F0;
    --muted: #8888AA;
    --card-bg: rgba(255,255,255,0.05);
    --card-border: rgba(255,215,0,0.15);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--deep);
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: 
      radial-gradient(ellipse at 20% 20%, rgba(255,215,0,0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(255,107,53,0.06) 0%, transparent 50%),
      radial-gradient(ellipse at 50% 50%, rgba(13,27,62,0.9) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
  }

  /* Header */
  header {
    text-align: center;
    padding: 40px 0 30px;
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(48px, 10vw, 80px);
    background: linear-gradient(135deg, #FFD700, #FFA500, #FF6B35);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: 4px;
    line-height: 1;
    filter: drop-shadow(0 0 30px rgba(255,215,0,0.3));
  }

  .logo-sub {
    font-size: 14px;
    color: var(--muted);
    letter-spacing: 6px;
    margin-top: 6px;
    text-transform: uppercase;
  }

  /* Jackpot Banner */
  .jackpot-banner {
    background: linear-gradient(135deg, rgba(255,215,0,0.12), rgba(255,107,53,0.08));
    border: 1px solid rgba(255,215,0,0.25);
    border-radius: 16px;
    padding: 20px 24px;
    margin: 24px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
  }

  .jackpot-label {
    font-size: 12px;
    color: var(--gold);
    letter-spacing: 3px;
    text-transform: uppercase;
    font-weight: 600;
  }

  .jackpot-amount {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(28px, 6vw, 44px);
    color: var(--gold);
    letter-spacing: 2px;
    filter: drop-shadow(0 0 10px rgba(255,215,0,0.5));
  }

  .round-info {
    text-align: right;
  }

  .round-num {
    font-size: 13px;
    color: var(--muted);
  }

  .round-num span {
    color: var(--gold);
    font-weight: 700;
  }

  .next-draw {
    font-size: 11px;
    color: var(--muted);
    margin-top: 4px;
  }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 8px;
    margin: 28px 0 20px;
    background: rgba(255,255,255,0.04);
    border-radius: 12px;
    padding: 6px;
  }

  .tab {
    flex: 1;
    padding: 10px 8px;
    border: none;
    background: transparent;
    color: var(--muted);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.25s;
    white-space: nowrap;
  }

  .tab.active {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
  }

  .tab:hover:not(.active) {
    color: var(--text);
    background: rgba(255,255,255,0.06);
  }

  /* Tab Panels */
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* Card */
  .card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 20px;
    padding: 28px;
    margin-bottom: 16px;
    backdrop-filter: blur(10px);
  }

  .card-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--muted);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 20px;
  }

  /* Lotto Balls */
  .balls-container {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    min-height: 70px;
    align-items: center;
  }

  .ball {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 900;
    position: relative;
    cursor: default;
    transition: transform 0.3s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3), inset 0 -3px 6px rgba(0,0,0,0.2), inset 0 3px 6px rgba(255,255,255,0.3);
  }

  .ball:hover { transform: scale(1.08); }

  .ball.yellow { background: linear-gradient(145deg, #FFE066, #FFC200); color: #5A3A00; }
  .ball.blue   { background: linear-gradient(145deg, #5BA3FF, #1565C0); color: #fff; }
  .ball.red    { background: linear-gradient(145deg, #FF6B6B, #C62828); color: #fff; }
  .ball.gray   { background: linear-gradient(145deg, #9E9E9E, #424242); color: #fff; }
  .ball.green  { background: linear-gradient(145deg, #66BB6A, #2E7D32); color: #fff; }

  .ball.bonus {
    position: relative;
  }
  .ball.bonus::after {
    content: '+';
    position: absolute;
    top: -8px;
    right: -4px;
    background: var(--accent);
    color: #fff;
    font-size: 10px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
  }

  .ball.empty {
    background: rgba(255,255,255,0.06);
    border: 2px dashed rgba(255,255,255,0.15);
    box-shadow: none;
    color: var(--muted);
    font-size: 24px;
  }

  .ball-placeholder {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(255,255,255,0.04);
    border: 2px dashed rgba(255,255,255,0.1);
    animation: pulse 1.5s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.8; }
  }

  @keyframes ballPop {
    0% { transform: scale(0) rotate(-180deg); opacity: 0; }
    70% { transform: scale(1.2) rotate(10deg); }
    100% { transform: scale(1) rotate(0); opacity: 1; }
  }

  .ball.animate { animation: ballPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

  /* Generate Controls */
  .gen-controls {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .btn {
    flex: 1;
    min-width: 120px;
    padding: 14px 20px;
    border: none;
    border-radius: 12px;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background: linear-gradient(135deg, #FFD700, #FF8C00);
    color: #000;
    box-shadow: 0 4px 20px rgba(255,215,0,0.3);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(255,215,0,0.5);
  }

  .btn-primary:active { transform: translateY(0); }

  .btn-secondary {
    background: rgba(255,255,255,0.07);
    color: var(--text);
    border: 1px solid rgba(255,255,255,0.12);
  }

  .btn-secondary:hover {
    background: rgba(255,255,255,0.12);
    border-color: rgba(255,255,255,0.2);
  }

  .btn-ghost {
    background: transparent;
    color: var(--muted);
    border: 1px solid rgba(255,255,255,0.08);
    font-size: 12px;
    padding: 10px 14px;
    flex: none;
  }

  /* Mode Select */
  .mode-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 20px;
  }

  .mode-btn {
    padding: 12px 8px;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    background: rgba(255,255,255,0.04);
    color: var(--muted);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }

  .mode-btn.active {
    border-color: var(--gold);
    background: rgba(255,215,0,0.1);
    color: var(--gold);
  }

  .mode-btn .icon { font-size: 18px; display: block; margin-bottom: 4px; }

  /* Saved Numbers */
  .saved-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .saved-item {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
    transition: border-color 0.2s;
  }

  .saved-item:hover { border-color: rgba(255,215,0,0.2); }

  .saved-balls { display: flex; gap: 6px; flex-wrap: wrap; }

  .mini-ball {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 900;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  .saved-meta { font-size: 11px; color: var(--muted); }
  .saved-meta span { color: var(--text); font-weight: 600; }

  .del-btn {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 16px;
    padding: 4px;
    opacity: 0.5;
    transition: opacity 0.2s;
  }
  .del-btn:hover { opacity: 1; color: #FF5252; }

  /* Stats */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(52px, 1fr));
    gap: 8px;
    margin-top: 8px;
  }

  .stat-ball-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  .stat-ball {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 900;
    position: relative;
  }

  .freq-bar-wrap {
    width: 44px;
    height: 4px;
    background: rgba(255,255,255,0.08);
    border-radius: 2px;
    overflow: hidden;
  }

  .freq-bar {
    height: 100%;
    background: linear-gradient(90deg, #FFD700, #FF8C00);
    border-radius: 2px;
    transition: width 0.8s ease;
  }

  .freq-count {
    font-size: 10px;
    color: var(--muted);
    font-weight: 600;
  }

  /* Hot/Cold badges */
  .hot-badge { color: #FF6B35; font-size: 10px; }
  .cold-badge { color: #5BA3FF; font-size: 10px; }

  /* Past results */
  .past-item {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 14px;
    padding: 14px 16px;
    margin-bottom: 10px;
  }

  .past-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .past-round { font-size: 13px; font-weight: 700; color: var(--gold); }
  .past-date { font-size: 11px; color: var(--muted); }

  /* Quick pick count */
  .count-control {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
  }

  .count-label { font-size: 13px; color: var(--muted); font-weight: 600; }

  .count-btns { display: flex; gap: 6px; }

  .count-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.05);
    color: var(--text);
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }

  .count-btn:hover { background: rgba(255,215,0,0.1); border-color: var(--gold); }

  .count-display {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 24px;
    color: var(--gold);
    min-width: 28px;
    text-align: center;
  }

  /* Multiple picks */
  .multi-row {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .multi-label {
    font-size: 11px;
    color: var(--muted);
    font-weight: 700;
    letter-spacing: 2px;
    min-width: 28px;
  }

  .multi-balls { display: flex; gap: 6px; flex-wrap: wrap; }

  /* Notice */
  .notice {
    background: rgba(255,107,53,0.08);
    border: 1px solid rgba(255,107,53,0.2);
    border-radius: 10px;
    padding: 12px 16px;
    font-size: 12px;
    color: var(--muted);
    margin-top: 16px;
    line-height: 1.6;
  }

  .notice strong { color: var(--accent); }

  /* Empty state */
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--muted);
  }

  .empty-icon { font-size: 48px; margin-bottom: 12px; }
  .empty-text { font-size: 14px; line-height: 1.6; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
  ::-webkit-scrollbar-thumb { background: rgba(255,215,0,0.2); border-radius: 3px; }

  @media (max-width: 480px) {
    .ball { width: 48px; height: 48px; font-size: 17px; }
    .jackpot-banner { flex-direction: column; text-align: center; }
    .round-info { text-align: center; }
    .mode-grid { grid-template-columns: repeat(3, 1fr); }
    .tabs { flex-wrap: wrap; }
    .tab { font-size: 12px; padding: 8px 6px; }
  }

  .cert-banner {
    display: flex; align-items: center; gap: 16px;
    background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,107,53,0.1));
    border: 1px solid rgba(255,215,0,0.3); border-radius: 16px;
    padding: 20px 24px; margin-bottom: 16px;
  }
  .cert-banner-icon { font-size: 40px; }
  .cert-banner-title { font-size: 18px; font-weight: 900; color: var(--gold); }
  .cert-banner-sub { font-size: 12px; color: var(--muted); margin-top: 4px; }
  .cert-rewards { display: grid; grid-template-columns: repeat(5,1fr); gap: 8px; margin-bottom: 16px; }
  .cert-reward-item { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 12px 8px; text-align: center; }
  .cert-reward-grade { font-size: 13px; font-weight: 900; margin-bottom: 6px; }
  .grade-1 { color: #FFD700; } .grade-3 { color: #CD7F32; } .grade-4 { color: #5BA3FF; } .grade-5 { color: var(--muted); }
  .cert-reward-desc { font-size: 10px; color: var(--muted); line-height: 1.5; }
  .cert-reward-desc strong { color: var(--text); }
  .cert-form { display: flex; flex-direction: column; gap: 10px; }
  .cert-form-row { display: flex; gap: 10px; }
  .cert-select, .cert-input { flex: 1; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 10px; padding: 12px 14px; color: var(--text); font-family: 'Noto Sans KR', sans-serif; font-size: 13px; outline: none; }
  .cert-select option { background: #1a1a2e; }
  .cert-select:focus, .cert-input:focus { border-color: var(--gold); }
  .cert-textarea { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 10px; padding: 12px 14px; color: var(--text); font-family: 'Noto Sans KR', sans-serif; font-size: 13px; resize: none; height: 80px; outline: none; width: 100%; }
  .cert-textarea:focus { border-color: var(--gold); }
  .cert-item { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.07); border-radius: 14px; padding: 16px; margin-bottom: 10px; transition: border-color 0.2s; }
  .cert-item:hover { border-color: rgba(255,215,0,0.2); }
  .cert-item.grade-1-item { background: rgba(255,215,0,0.06); border-color: rgba(255,215,0,0.3); }
  .cert-item-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
  .cert-item-left { display: flex; align-items: center; gap: 10px; }
  .cert-grade-badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 900; }
  .badge-1 { background: rgba(255,215,0,0.2); color: #FFD700; border: 1px solid rgba(255,215,0,0.4); }
  .badge-2 { background: rgba(192,192,192,0.2); color: #C0C0C0; border: 1px solid rgba(192,192,192,0.4); }
  .badge-3 { background: rgba(205,127,50,0.2); color: #CD7F32; border: 1px solid rgba(205,127,50,0.4); }
  .badge-4 { background: rgba(91,163,255,0.2); color: #5BA3FF; border: 1px solid rgba(91,163,255,0.4); }
  .badge-5 { background: rgba(255,255,255,0.08); color: var(--muted); border: 1px solid rgba(255,255,255,0.1); }
  .cert-nickname { font-size: 14px; font-weight: 700; color: var(--text); }
  .cert-date { font-size: 11px; color: var(--muted); }
  .cert-message { font-size: 13px; color: var(--muted); line-height: 1.6; margin-top: 4px; }
  .hall-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: rgba(255,215,0,0.06); border: 1px solid rgba(255,215,0,0.2); border-radius: 12px; margin-bottom: 8px; }
  .hall-crown { font-size: 28px; }
  .hall-name { font-size: 15px; font-weight: 900; color: var(--gold); }
  .hall-date { font-size: 11px; color: var(--muted); }
  .hall-msg { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .cert-empty { text-align: center; padding: 40px 20px; color: var(--muted); }
  .cert-empty-icon { font-size: 48px; margin-bottom: 12px; }
  .like-btn { background: none; border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; color: var(--muted); font-size: 11px; padding: 4px 10px; cursor: pointer; transition: all 0.2s; }
  .like-btn:hover { border-color: var(--accent); color: var(--accent); }
  .comment-section { margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.06); padding-top: 10px; }
  .comment-item { font-size: 12px; color: #ccc; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.04); display:flex; gap:8px; }
  .comment-nick { color: #FFD700; font-weight: 700; min-width: 60px; }
  .comment-input-row { display: flex; gap: 8px; margin-top: 8px; }
  .comment-input { flex:1; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px 10px; color: white; font-size: 12px; outline: none; font-family: inherit; }
  .comment-input:focus { border-color: #FFD700; }
  .comment-btn { background: rgba(255,215,0,0.15); border: 1px solid #FFD700; color: #FFD700; border-radius: 8px; padding: 8px 12px; font-size: 12px; cursor: pointer; font-family: inherit; white-space: nowrap; }
  .comment-toggle { background: none; border: none; color: #888; font-size: 11px; cursor: pointer; margin-left: 8px; }



  /* Footer */
  .site-footer {
    margin-top: 40px;
    padding: 24px;
    border-top: 1px solid rgba(255,255,255,0.06);
    text-align: center;
  }
  .footer-disclaimer {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px;
    padding: 16px 20px;
    font-size: 11px;
    color: var(--muted);
    line-height: 1.8;
    text-align: left;
    margin-bottom: 14px;
  }
  .footer-disclaimer strong { color: var(--accent); }
  .footer-bottom {
    font-size: 11px;
    color: rgba(255,255,255,0.2);
  }
  .footer-bottom span { color: var(--gold); opacity: 0.5; }


  .cert-photo-upload {
    border: 2px dashed rgba(255,215,0,0.3);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: rgba(255,215,0,0.03);
    position: relative;
  }
  .cert-photo-upload:hover {
    border-color: var(--gold);
    background: rgba(255,215,0,0.07);
  }
  .cert-photo-upload input[type=file] {
    position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
  }
  .cert-photo-icon { font-size: 32px; margin-bottom: 6px; }
  .cert-photo-text { font-size: 12px; color: var(--muted); }
  .cert-photo-text strong { color: var(--gold); }
  .cert-photo-preview {
    width: 100%; max-height: 200px; object-fit: cover;
    border-radius: 10px; display: none; margin-top: 8px;
  }
  .cert-item-photo {
    width: 100%; max-height: 180px; object-fit: cover;
    border-radius: 10px; margin-top: 10px;
    cursor: pointer;
  }
  .photo-modal {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.85); z-index: 9999;
    align-items: center; justify-content: center;
  }
  .photo-modal.open { display: flex; }
  .photo-modal img { max-width: 90vw; max-height: 90vh; border-radius: 12px; }
  .photo-modal-close {
    position: absolute; top: 20px; right: 20px;
    background: none; border: none; color: #fff;
    font-size: 32px; cursor: pointer;
  }


  .mode-desc {
    background: rgba(255,215,0,0.06);
    border: 1px solid rgba(255,215,0,0.15);
    border-radius: 12px;
    padding: 12px 16px;
    margin-top: 12px;
    margin-bottom: 4px;
    font-size: 12px;
    color: var(--muted);
    line-height: 1.7;
    min-height: 48px;
    transition: all 0.3s;
  }
  .mode-desc .desc-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--gold);
    margin-bottom: 4px;
  }

</style>
<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, addDoc, getDocs, orderBy, query, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCiBpw15eRlsp_KDG2aQhqoAfDKLjAeowI",
    authDomain: "lottobokdungi.firebaseapp.com",
    projectId: "lottobokdungi",
    storageBucket: "lottobokdungi.firebasestorage.app",
    messagingSenderId: "43441831820",
    appId: "1:43441831820:web:bc8fd8394c9876aef2e0a9",
    measurementId: "G-9R1X71FNS4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const googleProvider = new GoogleAuthProvider();

  // ì „ì—­ ë…¸ì¶œ
  window.fbAuth = auth;
  window.fbDb = db;
  window.fbFunctions = {
    createUserWithEmailAndPassword, signInWithEmailAndPassword,
    signOut, onAuthStateChanged, GoogleAuthProvider,
    signInWithPopup, doc, setDoc, getDoc, collection,
    addDoc, getDocs, orderBy, query, updateDoc, increment
  };

  // ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€
  onAuthStateChanged(auth, user => {
    if (user) {
      document.getElementById('auth-btn').textContent = 'ë‚´ ì •ë³´';
      document.getElementById('auth-btn').onclick = showMyPage;
      document.getElementById('logout-btn').style.display = 'inline-block';
      document.getElementById('user-name').textContent = user.displayName || user.email.split('@')[0];
      document.getElementById('user-info').style.display = 'flex';
      // Firestoreì—ì„œ ë‹¹ì²¨ì¸ì¦ ë¶ˆëŸ¬ì˜¤ê¸°
      loadCertFromFirestore();
    } else {
      document.getElementById('auth-btn').textContent = 'ë¡œê·¸ì¸';
      document.getElementById('auth-btn').onclick = showAuthModal;
      document.getElementById('logout-btn').style.display = 'none';
      document.getElementById('user-info').style.display = 'none';
    }
  });

  // ë¡œê·¸ì¸/íšŒì›ê°€ì…
  window.doEmailAuth = async function(isLogin) {
    const email = document.getElementById('auth-email').value;
    const pw = document.getElementById('auth-pw').value;
    const nick = document.getElementById('auth-nick')?.value;
    try {
      if (isLogin) {
        await signInWithEmailAndPassword(auth, email, pw);
      } else {
        const cred = await createUserWithEmailAndPassword(auth, email, pw);
        await setDoc(doc(db, 'users', cred.user.uid), {
          email, nickname: nick || email.split('@')[0],
          createdAt: new Date().toISOString()
        });
      }
      closeAuthModal();
    } catch(e) {
      let msg = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”!';
      if (e.code === 'auth/email-already-in-use') msg = 'ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì´ë©”ì¼ì´ì—ìš”!';
      if (e.code === 'auth/wrong-password') msg = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”!';
      if (e.code === 'auth/user-not-found') msg = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì´ì—ìš”!';
      if (e.code === 'auth/weak-password') msg = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•´ìš”!';
      document.getElementById('auth-error').textContent = msg;
    }
  };

  // êµ¬ê¸€ ë¡œê·¸ì¸
  window.doGoogleLogin = async function() {
    try {
      const result = await signInWithPopup(auth, googleProvider);
      const user = result.user;
      await setDoc(doc(db, 'users', user.uid), {
        email: user.email,
        nickname: user.displayName || user.email.split('@')[0],
        createdAt: new Date().toISOString()
      }, { merge: true });
      closeAuthModal();
    } catch(e) {
      document.getElementById('auth-error').textContent = 'êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨!';
    }
  };

  // ë¡œê·¸ì•„ì›ƒ
  window.doLogout = async function() {
    await signOut(auth);
  };

  // Firestoreì— ë‹¹ì²¨ì¸ì¦ ì €ì¥
  window.saveCertToFirestore = async function(certData) {
    try {
      const user = auth.currentUser;
      if (!user) return;
      await addDoc(collection(db, 'certs'), {
        ...certData,
        uid: user.uid,
        createdAt: new Date().toISOString()
      });
    } catch(e) {}
  };

  // Firestoreì—ì„œ ë‹¹ì²¨ì¸ì¦ ë¶ˆëŸ¬ì˜¤ê¸°
  window.loadCertFromFirestore = async function() {
    try {
      const q = query(collection(db, 'certs'), orderBy('createdAt', 'desc'));
      const snap = await getDocs(q);
      if (!snap.empty) {
        certList = snap.docs.map(d => ({...d.data(), id: d.id}));
        localStorage.setItem('lottoCert', JSON.stringify(certList));
        renderCert();
      }
    } catch(e) {}
  };
</script>
</head>
<body>
<div class="container">

  <!-- Header -->
  <header>
    <div class="logo">ë¡œë˜ë³µë©ì´</div>
    <div class="logo-sub">ğŸ€ ë³µë©ì´ê°€ í–‰ìš´ì„ ê°€ì ¸ë‹¤ë“œë ¤ìš” ğŸ€</div>
  </header>

  <!-- Auth Bar -->
  <div style="display:flex;justify-content:flex-end;align-items:center;gap:10px;padding:8px 16px 0;">
    <div id="user-info" style="display:none;align-items:center;gap:8px;">
      <span style="font-size:13px;color:#FFD700;">ğŸ‘¤ <span id="user-name"></span>ë‹˜</span>
    </div>
    <button id="auth-btn" onclick="showAuthModal()" style="background:rgba(255,215,0,0.15);border:1px solid #FFD700;color:#FFD700;padding:6px 16px;border-radius:20px;font-size:13px;cursor:pointer;font-family:inherit;">ë¡œê·¸ì¸</button>
    <button id="logout-btn" onclick="doLogout()" style="display:none;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);color:#aaa;padding:6px 12px;border-radius:20px;font-size:12px;cursor:pointer;font-family:inherit;">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <!-- Auth Modal -->
  <div id="auth-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;justify-content:center;align-items:center;">
    <div style="background:#12122a;border:1px solid rgba(255,215,0,0.3);border-radius:20px;padding:32px;width:90%;max-width:360px;position:relative;">
      <button onclick="closeAuthModal()" style="position:absolute;top:16px;right:16px;background:none;border:none;color:#aaa;font-size:20px;cursor:pointer;">âœ•</button>
      
      <!-- íƒ­ -->
      <div style="display:flex;gap:0;margin-bottom:24px;background:rgba(255,255,255,0.05);border-radius:12px;padding:4px;">
        <button id="tab-login" onclick="switchAuthTab('login')" style="flex:1;padding:10px;border:none;border-radius:10px;background:#FFD700;color:#000;font-weight:700;font-size:14px;cursor:pointer;font-family:inherit;">ë¡œê·¸ì¸</button>
        <button id="tab-signup" onclick="switchAuthTab('signup')" style="flex:1;padding:10px;border:none;border-radius:10px;background:transparent;color:#aaa;font-size:14px;cursor:pointer;font-family:inherit;">íšŒì›ê°€ì…</button>
      </div>

      <!-- êµ¬ê¸€ ë¡œê·¸ì¸ -->
      <button onclick="doGoogleLogin()" style="width:100%;padding:12px;background:white;color:#333;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;margin-bottom:16px;display:flex;align-items:center;justify-content:center;gap:8px;font-family:inherit;">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width:20px;height:20px;">
        êµ¬ê¸€ë¡œ ê³„ì†í•˜ê¸°
      </button>

      <div style="text-align:center;color:#555;font-size:12px;margin-bottom:16px;">ë˜ëŠ”</div>

      <!-- ë‹‰ë„¤ì„ (íšŒì›ê°€ì…ë§Œ) -->
      <div id="nick-field" style="display:none;margin-bottom:10px;">
        <input id="auth-nick" placeholder="ë‹‰ë„¤ì„" style="width:100%;padding:12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);border-radius:12px;color:white;font-size:14px;outline:none;box-sizing:border-box;font-family:inherit;">
      </div>

      <input id="auth-email" type="email" placeholder="ì´ë©”ì¼" style="width:100%;padding:12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);border-radius:12px;color:white;font-size:14px;outline:none;box-sizing:border-box;margin-bottom:10px;font-family:inherit;">
      <input id="auth-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" style="width:100%;padding:12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);border-radius:12px;color:white;font-size:14px;outline:none;box-sizing:border-box;margin-bottom:10px;font-family:inherit;">
      
      <p id="auth-error" style="color:#ff6b6b;font-size:12px;margin-bottom:10px;text-align:center;"></p>

      <button id="auth-submit-btn" onclick="doEmailAuth(true)" style="width:100%;padding:14px;background:linear-gradient(135deg,#FFD700,#FFA500);border:none;border-radius:12px;color:#000;font-size:15px;font-weight:900;cursor:pointer;font-family:inherit;">ë¡œê·¸ì¸</button>
    </div>
  </div>

  <!-- Jackpot Banner -->
  <div class="jackpot-banner">
    <div>
      <div class="jackpot-label">ì €ë²ˆì£¼ 1ë“± ë‹¹ì²¨ê¸ˆ (1212íšŒ)</div>
      <div class="jackpot-amount" id="jackpot-amount">â‚© 2,654,089,032</div>
    </div>
    <div class="round-info">
      <div class="round-num">ì œ <span id="current-round">...</span>íšŒ</div>
      <div class="next-draw">ğŸ—“ ë‹¤ìŒ ë‹¹ì²¨ì¼: <span id="next-draw-date">ê³„ì‚° ì¤‘...</span></div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" onclick="switchTab('generate')">í–‰ìš´ ë½‘ê¸°</button>
    <button class="tab" onclick="switchTab('multiple')">ìë™ ë½‘ê¸°</button>
    <button class="tab" onclick="switchTab('saved')">ì €ì¥ ë²ˆí˜¸</button>
    <button class="tab" onclick="switchTab('stats')">í†µê³„</button>
    <button class="tab" onclick="switchTab('past')">ë‹¹ì²¨ë²ˆí˜¸</button>
    <button class="tab" onclick="switchTab('cert')">ë‹¹ì²¨ì¸ì¦</button>
  </div>

  <!-- Tab: ë²ˆí˜¸ ìƒì„± -->
  <div id="tab-generate" class="tab-panel active">
    <div class="card">
      <div class="card-title">âœ¨ ì˜¤ëŠ˜ì˜ í–‰ìš´ ë°©ì‹ ì„ íƒ</div>
      <div class="mode-grid">
        <button class="mode-btn active" onclick="setMode('random', this)">
          <span class="icon">ğŸ²</span>ìˆœìˆ˜ í–‰ìš´
        </button>
        <button class="mode-btn" onclick="setMode('hot', this)">
          <span class="icon">ğŸ”¥</span>ëœ¨ëŠ” ë²ˆí˜¸
        </button>
        <button class="mode-btn" onclick="setMode('cold', this)">
          <span class="icon">â„ï¸</span>ë•Œë¥¼ ê¸°ë‹¤ë¦°
        </button>
        <button class="mode-btn" onclick="setMode('balanced', this)">
          <span class="icon">âš–ï¸</span>í™©ê¸ˆ ê· í˜•
        </button>
        <button class="mode-btn" onclick="setMode('oddeven', this)">
          <span class="icon">ğŸ”¢</span>í™©ê¸ˆ ë¹„ìœ¨
        </button>
        <button class="mode-btn" onclick="setMode('lucky', this)">
          <span class="icon">ğŸ€</span>ë³µë©ì´ ì¶”ì²œ
        </button>
      </div>

      <div class="mode-desc" id="mode-desc">
        <div class="desc-title">ìˆœìˆ˜ í–‰ìš´</div>
        1ë¶€í„° 45ê¹Œì§€ ìˆ«ì ì¤‘ì—ì„œ ì™„ì „íˆ ëœë¤ìœ¼ë¡œ 6ê°œë¥¼ ë½‘ì•„ìš”. ê°€ì¥ ê³µí‰í•˜ê³  ìˆœìˆ˜í•œ ë°©ì‹ì´ì—ìš” ğŸ˜Š
      </div>

      <div class="balls-container" id="main-balls">
        <div class="ball empty">?</div>
        <div class="ball empty">?</div>
        <div class="ball empty">?</div>
        <div class="ball empty">?</div>
        <div class="ball empty">?</div>
        <div class="ball empty">?</div>
      </div>

      <div class="gen-controls">
        <button class="btn btn-primary" onclick="generateNumbers()">ë³µë©ì´ì•¼ ë²ˆí˜¸ ë½‘ì•„ì¤˜!</button>
        <button class="btn btn-secondary" onclick="saveCurrentNumbers()">ğŸ’¾ í–‰ìš´ ì €ì¥</button>
        <button class="btn btn-ghost" onclick="clearBalls()">â†º</button>
      </div>
    </div>

    <div class="notice">
      <strong>âš ï¸ ì•ˆë‚´</strong> ë³µë©ì´ê°€ ì—´ì‹¬íˆ ë½‘ì•„ë“œë¦° ë²ˆí˜¸ì˜ˆìš” ğŸ€ ì¬ë¯¸ë¡œ ì¦ê²¨ì£¼ì„¸ìš”! ì´ ë²ˆí˜¸ë¡œ ë°˜ë“œì‹œ ë‹¹ì²¨ëœë‹¤ëŠ” ë³´ì¥ì€ ì—†ë‹µë‹ˆë‹¤. ë¡œë˜ëŠ” ë§Œ 19ì„¸ ì´ìƒ êµ¬ë§¤ ê°€ëŠ¥í•´ìš” ğŸ˜Š
    </div>
  </div>

  <!-- Tab: ìë™ 5ê²Œì„ -->
  <div id="tab-multiple" class="tab-panel">
    <div class="card">
      <div class="card-title">ğŸ€ ë³µë©ì´ê°€ ëŒ€ì‹  ë½‘ì•„ë“œë ¤ìš”</div>
      <div class="count-control">
        <span class="count-label">ê²Œì„ ìˆ˜</span>
        <div class="count-btns">
          <button class="count-btn" onclick="changeCount(-1)">âˆ’</button>
          <div class="count-display" id="game-count">5</div>
          <button class="count-btn" onclick="changeCount(1)">+</button>
        </div>
      </div>
      <div id="multi-results"></div>
      <div class="gen-controls">
        <button class="btn btn-primary" onclick="generateMultiple()">ë³µë©ì´ì•¼ ë‹¤ ë½‘ì•„ì¤˜!</button>
        <button class="btn btn-secondary" onclick="saveAllMultiple()">ğŸ’¾ ì „ì²´ í–‰ìš´ ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- Tab: ì €ì¥ ë²ˆí˜¸ -->
  <div id="tab-saved" class="tab-panel">
    <div class="card">
      <div class="card-title">ğŸ’¾ ë‚´ í–‰ìš´ ë²ˆí˜¸ ëª¨ìŒ</div>
      <div id="saved-list" class="saved-list">
        <div class="empty-state">
          <div class="empty-icon">ğŸ“‚</div>
          <div class="empty-text">ì €ì¥ëœ ë²ˆí˜¸ê°€ ì—†ì–´ìš”.<br>ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ê³  ì €ì¥í•´ë³´ì„¸ìš”!</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab: í†µê³„ -->
  <div id="tab-stats" class="tab-panel">
    <div class="card">
      <div class="card-title">ëœ¨ëŠ” ë²ˆí˜¸ (ë§ì´ ë‚˜ì˜¨ ë²ˆí˜¸)</div>
      <div id="hot-stats" class="stats-grid"></div>
    </div>
    <div class="card">
      <div class="card-title">ë•Œë¥¼ ê¸°ë‹¤ë¦° (ì ê²Œ ë‚˜ì˜¨ ë²ˆí˜¸)</div>
      <div id="cold-stats" class="stats-grid"></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“ˆ ì „ì²´ ë²ˆí˜¸ ë¹ˆë„</div>
      <div id="all-stats" class="stats-grid"></div>
    </div>
  </div>

  <!-- Tab: ë‹¹ì²¨ë²ˆí˜¸ -->
  <div id="tab-past" class="tab-panel">
    <div class="card">
      <div class="card-title">ìµœê·¼ ë‹¹ì²¨ë²ˆí˜¸</div>
      <div id="past-results"></div>
    </div>
  </div>


  <!-- Tab: ë‹¹ì²¨ ì¸ì¦ -->
  <div id="tab-cert" class="tab-panel">
    <div class="cert-banner">
      <div class="cert-banner-icon">ğŸ‰</div>
      <div>
        <div class="cert-banner-title">ë‹¹ì²¨ ì¸ì¦ ê²Œì‹œíŒ</div>
        <div class="cert-banner-sub">ë¡œë˜ë³µë©ì´ë¡œ ë‹¹ì²¨ë˜ì…¨ë‚˜ìš”? ìë‘í•´ì£¼ì„¸ìš”! í˜œíƒë„ ë“œë ¤ìš” ğŸ</div>
      </div>
    </div>
    <div class="cert-rewards">
      <div class="cert-reward-item"><div class="cert-reward-grade grade-5">5ë“±</div><div class="cert-reward-desc">ì¸ì¦ ì‹œ<br><strong>1ì£¼ ë¬´ë£Œ</strong></div></div>
      <div class="cert-reward-item"><div class="cert-reward-grade grade-4">4ë“±</div><div class="cert-reward-desc">ì¸ì¦ ì‹œ<br><strong>1ê°œì›” ë¬´ë£Œ</strong></div></div>
      <div class="cert-reward-item"><div class="cert-reward-grade grade-3">3ë“± ğŸ¥‰</div><div class="cert-reward-desc">ì¸ì¦ ì‹œ<br><strong>6ê°œì›” ë¬´ë£Œ</strong></div></div>
      <div class="cert-reward-item"><div class="cert-reward-grade grade-4">2ë“± ğŸ¥ˆ</div><div class="cert-reward-desc">ì¸ì¦ ì‹œ<br><strong>1ë…„ ë¬´ë£Œ</strong></div></div>
      <div class="cert-reward-item"><div class="cert-reward-grade grade-1">1ë“± ğŸ‘‘</div><div class="cert-reward-desc">ì¸ì¦ ì‹œ<br><strong>ì˜êµ¬ë¬´ë£Œ+ëª…ì˜ˆì˜ì „ë‹¹</strong></div></div>
    </div>
    <div class="card">
      <div class="card-title">âœï¸ ë‹¹ì²¨ ì¸ì¦í•˜ê¸°</div>
      <div class="cert-form">
        <div class="cert-form-row">
          <select class="cert-select" id="cert-grade">
            <option value="">ë“±ìˆ˜ ì„ íƒ í•„ìˆ˜!</option>
            <option value="1">ğŸ‘‘ 1ë“± (ì•½ 27ì–µ)</option>
            <option value="2">ğŸ¥ˆ 2ë“± (ì•½ 6ì²œë§Œì›)</option>
            <option value="3">ğŸ¥‰ 3ë“± (ì•½ 150ë§Œì›)</option>
            <option value="4">4ë“± (5ë§Œì›)</option>
            <option value="5">5ë“± (5ì²œì›)</option>
          </select>
          <input class="cert-input" id="cert-nickname" type="text" placeholder="ë‹‰ë„¤ì„ (ìµœëŒ€ 10ì)" maxlength="10">
        </div>
        <textarea class="cert-textarea" id="cert-message" placeholder="ë‹¹ì²¨ ì†Œê° í•œë§ˆë””! (ì„ íƒì‚¬í•­)"></textarea>
        <div class="cert-photo-upload" onclick="document.getElementById('cert-photo').click()">
          <input type="file" id="cert-photo" accept="image/*" onchange="previewPhoto(this)" onclick="event.stopPropagation()">
          <div class="cert-photo-icon">ğŸ“¸</div>
          <div class="cert-photo-text"><strong>ë‹¹ì²¨ ì¸ì¦ìƒ· ì˜¬ë¦¬ê¸°</strong> (ì„ íƒì‚¬í•­)<br>ë‹¹ì²¨ í™”ë©´ ìº¡ì²˜ë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”!</div>
          <img id="cert-photo-preview" class="cert-photo-preview" src="" alt="ë¯¸ë¦¬ë³´ê¸°">
        </div>
        <button class="btn btn-primary" onclick="submitCert()" style="width:100%;margin-top:4px;">ğŸ‰ ì¸ì¦ ë“±ë¡í•˜ê¸°</button>
      </div>
    </div>
    <div class="card" id="hall-of-fame-card" style="display:none">
      <div class="card-title">ğŸ‘‘ ëª…ì˜ˆì˜ ì „ë‹¹</div>
      <div id="hall-of-fame"></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“‹ ë‹¹ì²¨ ì¸ì¦ ëª©ë¡ <span id="cert-count" style="color:var(--gold);font-size:12px;margin-left:6px;"></span></div>
      <div id="cert-list"></div>
    </div>
  </div>


  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-disclaimer">
      <strong>âš ï¸ ë©´ì±… ê³µì§€ (í•„ë…)</strong><br>
      ë³¸ ì‚¬ì´íŠ¸(ë¡œë˜ë³µë©ì´)ëŠ” í†µê³„ ê¸°ë°˜ ë²ˆí˜¸ ìƒì„± ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ë©°, <strong>ë‹¹ì²¨ì„ ì ˆëŒ€ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong>
      ìƒì„±ëœ ë²ˆí˜¸ëŠ” ì°¸ê³ ìš©ì´ë©° ë‹¹ì²¨ ê²°ê³¼ì— ëŒ€í•œ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.<br><br>
      ìœ ë£Œ ë©¤ë²„ì‹­ì€ ë²ˆí˜¸ ìƒì„± í¸ì˜ ê¸°ëŠ¥ì— ëŒ€í•œ ì´ìš©ë£Œì´ë©°, ë‹¹ì²¨ ë²ˆí˜¸ íŒë§¤ê°€ ì•„ë‹™ë‹ˆë‹¤.
      ë¡œë˜ëŠ” <strong>ë§Œ 19ì„¸ ì´ìƒ</strong>ë§Œ êµ¬ë§¤ ê°€ëŠ¥í•˜ë©° ê±´ì „í•˜ê²Œ ì¦ê²¨ì£¼ì„¸ìš”.
      ë„ë°• ë¬¸ì œë¡œ ì–´ë ¤ì›€ì„ ê²ªê³  ê³„ì‹œë‹¤ë©´ <strong>í•œêµ­ë„ë°•ë¬¸ì œì˜ˆë°©ì¹˜ìœ ì› 1336</strong>ìœ¼ë¡œ ì—°ë½í•˜ì„¸ìš”.
    </div>
    <div class="footer-bottom">
      <span>ğŸ€ ë¡œë˜ë³µë©ì´</span> Â· ë²ˆí˜¸ ìƒì„± ì„œë¹„ìŠ¤ Â· ë‹¹ì²¨ ë³´ì¥ ì—†ìŒ<br>
      Â© 2025 ë¡œë˜ë³µë©ì´. All Rights Reserved.
    </div>
  </footer>

</div>

<script>
// ===================== DATA =====================
const pastResults = [
  { round: 1212, date: '2026.02.21', numbers: [5, 8, 25, 31, 41, 44], bonus: 45 },
  { round: 1211, date: '2026.02.14', numbers: [23, 26, 27, 35, 38, 40], bonus: 10 },
  { round: 1210, date: '2026.02.07', numbers: [1, 7, 9, 17, 27, 38], bonus: 31 },
  { round: 1209, date: '2026.01.31', numbers: [2, 17, 20, 35, 37, 39], bonus: 24 },
  { round: 1208, date: '2026.01.24', numbers: [6, 27, 30, 36, 38, 42], bonus: 25 },
  { round: 1207, date: '2026.01.17', numbers: [10, 22, 24, 27, 38, 45], bonus: 11 },
  { round: 1206, date: '2026.01.10', numbers: [1, 3, 17, 26, 27, 42], bonus: 23 },
  { round: 1205, date: '2026.01.03', numbers: [1, 4, 16, 23, 31, 41], bonus: 2 },
  { round: 1204, date: '2025.12.27', numbers: [8, 16, 28, 30, 31, 44], bonus: 27 },
  { round: 1203, date: '2025.12.20', numbers: [3, 6, 18, 29, 35, 39], bonus: 24 },
];

// Compute frequency from past results
// ì—­ëŒ€ 1~1212íšŒ ì‹¤ì œ ë¹ˆë„ ë°ì´í„°
const freqMap = {
  1:195, 2:188, 3:201, 4:192, 5:196, 6:198, 7:185,
  8:193, 9:189, 10:197, 11:191, 12:194, 13:186, 14:190,
  15:199, 16:203, 17:195, 18:188, 19:192, 20:197,
  21:189, 22:193, 23:200, 24:196, 25:191, 26:198,
  27:207, 28:194, 29:188, 30:196, 31:202, 32:190,
  33:195, 34:211, 35:198, 36:192, 37:196, 38:201,
  39:193, 40:197, 41:189, 42:195, 43:188, 44:193, 45:196
};

const sortedByFreq = Object.entries(freqMap).sort((a,b) => b[1]-a[1]).map(e => parseInt(e[0]));
const hotNumbers = sortedByFreq.slice(0, 15);
const coldNumbers = sortedByFreq.slice(-15).reverse();

let currentMode = 'random';
let gameCount = 5;
let savedNumbers = JSON.parse(localStorage.getItem('lottoSaved') || '[]');
let multiNumbers = [];

// ===================== BALL COLOR =====================
function getBallClass(n) {
  if (n <= 10) return 'yellow';
  if (n <= 20) return 'blue';
  if (n <= 30) return 'red';
  if (n <= 40) return 'gray';
  return 'green';
}

function createBallEl(n, isBonus = false, size = 'normal') {
  const div = document.createElement('div');
  div.className = `ball ${getBallClass(n)}${isBonus ? ' bonus' : ''}`;
  if (size === 'mini') div.className = `mini-ball ${getBallClass(n)}`;
  if (size === 'stat') div.className = `stat-ball ${getBallClass(n)}`;
  div.textContent = n;
  return div;
}

// ===================== GENERATE =====================
function pickNumbers(mode) {
  let pool = Array.from({length: 45}, (_, i) => i + 1);
  let nums = [];

  if (mode === 'random') {
    shuffle(pool);
    nums = pool.slice(0, 6);
  } else if (mode === 'hot') {
    let hp = [...hotNumbers];
    shuffle(hp);
    nums = hp.slice(0, 6);
  } else if (mode === 'cold') {
    let cp = [...coldNumbers];
    shuffle(cp);
    nums = cp.slice(0, 6);
  } else if (mode === 'balanced') {
    let hot3 = [...hotNumbers]; shuffle(hot3);
    let cold3 = [...coldNumbers]; shuffle(cold3);
    nums = [...hot3.slice(0,3), ...cold3.slice(0,3)];
  } else if (mode === 'oddeven') {
    let odds = pool.filter(n => n % 2 !== 0);
    let evens = pool.filter(n => n % 2 === 0);
    shuffle(odds); shuffle(evens);
    nums = [...odds.slice(0,3), ...evens.slice(0,3)];
  } else if (mode === 'lucky') {
    // Weighted pick
    const weights = pool.map(n => freqMap[n] + 1);
    const total = weights.reduce((a,b)=>a+b,0);
    while (nums.length < 6) {
      let rand = Math.random() * total;
      let cum = 0;
      for (let i = 0; i < pool.length; i++) {
        cum += weights[i];
        if (rand <= cum && !nums.includes(pool[i])) {
          nums.push(pool[i]);
          break;
        }
      }
    }
  }

  return nums.sort((a,b)=>a-b);
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

let currentNumbers = [];

function generateNumbers() {
  currentNumbers = pickNumbers(currentMode);
  renderMainBalls(currentNumbers);
}

function renderMainBalls(nums) {
  const container = document.getElementById('main-balls');
  container.innerHTML = '';
  nums.forEach((n, i) => {
    const ball = createBallEl(n);
    ball.style.opacity = '0';
    ball.style.animationDelay = `${i * 80}ms`;
    container.appendChild(ball);
    setTimeout(() => {
      ball.classList.add('animate');
      ball.style.opacity = '1';
    }, i * 80);
  });
}

function clearBalls() {
  currentNumbers = [];
  const container = document.getElementById('main-balls');
  container.innerHTML = '';
  for (let i = 0; i < 6; i++) {
    const div = document.createElement('div');
    div.className = 'ball empty';
    div.textContent = '?';
    container.appendChild(div);
  }
}

function setMode(mode, btn) {
  currentMode = mode;
  document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const descs = {
    'random': { title: 'ìˆœìˆ˜ í–‰ìš´', desc: '1ë¶€í„° 45ê¹Œì§€ ìˆ«ì ì¤‘ì—ì„œ ì™„ì „íˆ ëœë¤ìœ¼ë¡œ 6ê°œë¥¼ ë½‘ì•„ìš”. ê°€ì¥ ê³µí‰í•˜ê³  ìˆœìˆ˜í•œ ë°©ì‹ì´ì—ìš” ğŸ˜Š' },
    'hot': { title: 'ëœ¨ëŠ” ë²ˆí˜¸', desc: 'ìµœê·¼ ë‹¹ì²¨ì—ì„œ ìì£¼ ë‚˜ì˜¨ ë²ˆí˜¸ë“¤ ìœ„ì£¼ë¡œ ë½‘ì•„ìš”. ìš”ì¦˜ ì˜ ë‚˜ì˜¤ëŠ” ë²ˆí˜¸ì— ì˜¬ë¼íƒ€ëŠ” ë°©ì‹ì´ì—ìš” ğŸ”¥' },
    'cold': { title: 'ë•Œë¥¼ ê¸°ë‹¤ë¦°', desc: 'ìµœê·¼ì— í•œ ë²ˆë„ ì•ˆ ë‚˜ì˜¨ ë²ˆí˜¸ë“¤ì„ ë½‘ì•„ìš”. ì˜¤ë«ë™ì•ˆ ê¸°ë‹¤ë¦° ë²ˆí˜¸ê°€ ì´ë²ˆì—” ë‚˜ì˜¬ ê±°ë¼ëŠ” ë¯¿ìŒì´ì—ìš” â„ï¸' },
    'balanced': { title: 'í™©ê¸ˆ ê· í˜•', desc: 'ìì£¼ ë‚˜ì˜¨ ë²ˆí˜¸ 3ê°œ + ì•ˆ ë‚˜ì˜¨ ë²ˆí˜¸ 3ê°œë¥¼ ê· í˜•ìˆê²Œ ì„ì–´ìš”. ì¤‘ê°„ì„ ë…¸ë¦¬ëŠ” ì•ˆì •ì ì¸ ë°©ì‹ì´ì—ìš” âš–ï¸' },
    'oddeven': { title: 'í™©ê¸ˆ ë¹„ìœ¨', desc: 'í™€ìˆ˜ 3ê°œ + ì§ìˆ˜ 3ê°œë¥¼ ì •í™•íˆ ë°˜ë°˜ì”© ë½‘ì•„ìš”. ì‹¤ì œ ë‹¹ì²¨ë²ˆí˜¸ì—ì„œ í™€ì§ì´ ê³¨ê³ ë£¨ ë‚˜ì˜¤ëŠ” ê²½ìš°ê°€ ë§ì•„ìš” ğŸ”¢' },
    'lucky': { title: 'ë³µë©ì´ ì¶”ì²œ', desc: 'ë³µë©ì´ê°€ ê³¼ê±° ë°ì´í„°ë¥¼ ë³´ê³  ë‚˜ì˜¬ ê²ƒ ê°™ì€ ë²ˆí˜¸ì— ì‚´ì§ í˜ì„ ì‹¤ì–´ì„œ ë½‘ì•„ì¤˜ìš”. ë³µë©ì´ íŠ¹ì œ ë°©ì‹ì´ì—ìš” ğŸ€' }
  };
  const d = descs[mode];
  if (d) {
    document.getElementById('mode-desc').innerHTML = '<div class="desc-title">'+d.title+'</div>' + d.desc;
  }
}

// ===================== SAVE =====================
function saveCurrentNumbers() {
  if (currentNumbers.length !== 6) {
    alert('ë¨¼ì € ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”!'); return;
  }
  const entry = { nums: currentNumbers, date: new Date().toLocaleDateString('ko-KR'), mode: currentMode };
  savedNumbers.unshift(entry);
  if (savedNumbers.length > 20) savedNumbers.pop();
  localStorage.setItem('lottoSaved', JSON.stringify(savedNumbers));
  renderSaved();
  // Flash feedback
  const btn = event.target;
  btn.textContent = 'âœ… ì €ì¥ë¨!';
  setTimeout(() => btn.textContent = 'ğŸ’¾ í–‰ìš´ ì €ì¥', 1500);
}

function renderSaved() {
  const container = document.getElementById('saved-list');
  if (savedNumbers.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‚</div><div class="empty-text">ì €ì¥ëœ ë²ˆí˜¸ê°€ ì—†ì–´ìš”.<br>ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ê³  ì €ì¥í•´ë³´ì„¸ìš”!</div></div>`;
    return;
  }
  container.innerHTML = '';
  savedNumbers.forEach((entry, idx) => {
    const item = document.createElement('div');
    item.className = 'saved-item';
    const ballsDiv = document.createElement('div');
    ballsDiv.className = 'saved-balls';
    entry.nums.forEach(n => ballsDiv.appendChild(createBallEl(n, false, 'mini')));
    const meta = document.createElement('div');
    meta.className = 'saved-meta';
    const modeLabel = { random:'ëœë¤', hot:'ëœ¨ëŠ” ë²ˆí˜¸', cold:'ë•Œë¥¼ ê¸°ë‹¤ë¦°', balanced:'í™©ê¸ˆ ê· í˜•', oddeven:'í™€ì§', lucky:'í–‰ìš´AI' };
    meta.innerHTML = `<span>${entry.date}</span> Â· ${modeLabel[entry.mode] || entry.mode}`;
    const del = document.createElement('button');
    del.className = 'del-btn';
    del.textContent = 'Ã—';
    del.onclick = () => { savedNumbers.splice(idx, 1); localStorage.setItem('lottoSaved', JSON.stringify(savedNumbers)); renderSaved(); };
    item.appendChild(ballsDiv);
    item.appendChild(meta);
    item.appendChild(del);
    container.appendChild(item);
  });
}

// ===================== MULTIPLE =====================
function changeCount(delta) {
  gameCount = Math.min(10, Math.max(1, gameCount + delta));
  document.getElementById('game-count').textContent = gameCount;
}

function generateMultiple() {
  multiNumbers = [];
  const container = document.getElementById('multi-results');
  container.innerHTML = '';
  for (let g = 0; g < gameCount; g++) {
    const nums = pickNumbers('random');
    multiNumbers.push(nums);
    const row = document.createElement('div');
    row.className = 'multi-row';
    const label = document.createElement('div');
    label.className = 'multi-label';
    label.textContent = String.fromCharCode(65 + g);
    const balls = document.createElement('div');
    balls.className = 'multi-balls';
    nums.forEach((n, i) => {
      const ball = createBallEl(n, false, 'mini');
      ball.style.opacity = '0';
      balls.appendChild(ball);
      setTimeout(() => { ball.style.opacity='1'; ball.style.transition='opacity 0.3s'; }, g*100 + i*40);
    });
    row.appendChild(label);
    row.appendChild(balls);
    container.appendChild(row);
  }
}

function saveAllMultiple() {
  if (multiNumbers.length === 0) { alert('ë¨¼ì € ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”!'); return; }
  multiNumbers.forEach(nums => {
    savedNumbers.unshift({ nums, date: new Date().toLocaleDateString('ko-KR'), mode: 'random' });
  });
  if (savedNumbers.length > 20) savedNumbers = savedNumbers.slice(0, 20);
  localStorage.setItem('lottoSaved', JSON.stringify(savedNumbers));
  renderSaved();
  const btn = event.target;
  btn.textContent = 'âœ… ì €ì¥ë¨!';
  setTimeout(() => btn.textContent = 'ğŸ’¾ ì „ì²´ í–‰ìš´ ì €ì¥', 1500);
}

// ===================== STATS =====================
function renderStats() {
  const maxFreq = Math.max(...Object.values(freqMap));

  function renderStatGroup(containerId, numbers) {
    const c = document.getElementById(containerId);
    c.innerHTML = '';
    numbers.forEach(n => {
      const wrap = document.createElement('div');
      wrap.className = 'stat-ball-wrap';
      const ball = document.createElement('div');
      ball.className = `stat-ball ${getBallClass(n)}`;
      ball.textContent = n;
      const barWrap = document.createElement('div');
      barWrap.className = 'freq-bar-wrap';
      const bar = document.createElement('div');
      bar.className = 'freq-bar';
      bar.style.width = '0%';
      setTimeout(() => bar.style.width = `${(freqMap[n]/maxFreq)*100}%`, 300);
      barWrap.appendChild(bar);
      const count = document.createElement('div');
      count.className = 'freq-count';
      count.textContent = freqMap[n] + 'íšŒ';
      wrap.appendChild(ball);
      wrap.appendChild(barWrap);
      wrap.appendChild(count);
      c.appendChild(wrap);
    });
  }

  renderStatGroup('hot-stats', hotNumbers.slice(0,10));
  renderStatGroup('cold-stats', coldNumbers.slice(0,10));
  renderStatGroup('all-stats', Array.from({length:45},(_,i)=>i+1));
}

// ===================== PAST RESULTS =====================
function renderPast() {
  const c = document.getElementById('past-results');
  c.innerHTML = '';
  pastResults.forEach(r => {
    const item = document.createElement('div');
    item.className = 'past-item';
    const header = document.createElement('div');
    header.className = 'past-header';
    header.innerHTML = `<span class="past-round">ì œ ${r.round}íšŒ</span><span class="past-date">${r.date} ì¶”ì²¨</span>`;
    const balls = document.createElement('div');
    balls.style.cssText = 'display:flex;gap:6px;flex-wrap:wrap;align-items:center;';
    r.numbers.forEach(n => balls.appendChild(createBallEl(n, false, 'mini')));
    const plus = document.createElement('span');
    plus.style.cssText = 'color:var(--muted);font-size:12px;margin:0 2px;';
    plus.textContent = '+';
    balls.appendChild(plus);
    balls.appendChild(createBallEl(r.bonus, true, 'mini'));
    item.appendChild(header);
    item.appendChild(balls);
    c.appendChild(item);
  });
}

// ===================== TABS =====================
function switchTab(name) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(`tab-${name}`).classList.add('active');
  event.target.classList.add('active');
}

// ===================== INIT =====================
renderSaved();
renderStats();
renderPast();
generateMultiple();

// Animate jackpot amount


// ===================== JACKPOT =====================
async function fetchJackpot() {
  // íšŒì°¨ ìë™ ê³„ì‚°
  const baseDate = new Date('2002-12-07');
  const now = new Date();
  const diffDays = Math.floor((now - baseDate) / (1000 * 60 * 60 * 24));
  let currentRound = 1 + Math.floor(diffDays / 7);
  const dayOfWeek = now.getDay();
  const hour = now.getHours();
  if (dayOfWeek === 6 && hour < 21) currentRound -= 1;
  document.getElementById('current-round').textContent = currentRound;

  try {
    const res = await fetch('/api/lotto');
    const data = await res.json();
    if (data.prize && data.prize > 0) {
      document.getElementById('jackpot-amount').textContent = 'â‚© ' + data.prize.toLocaleString('ko-KR');
      document.querySelector('.jackpot-label').textContent = `ì €ë²ˆì£¼ 1ë“± ë‹¹ì²¨ê¸ˆ (${data.round}íšŒ)`;
      document.getElementById('current-round').textContent = data.round + 1;
    }
  } catch(e) {}
}

// ë‹¤ìŒ ë‹¹ì²¨ì¼ ê³„ì‚°
function calcNextDraw() {
  const now = new Date();
  const day = now.getDay(); // 0=ì¼, 6=í† 
  let daysUntilSat = (6 - day + 7) % 7;
  if (daysUntilSat === 0) {
    const hours = now.getHours();
    if (hours >= 21) daysUntilSat = 7; // í† ìš”ì¼ 9ì‹œ ì´í›„ë©´ ë‹¤ìŒì£¼
  }
  const next = new Date(now);
  next.setDate(now.getDate() + daysUntilSat);
  const month = next.getMonth() + 1;
  const date = next.getDate();
  document.getElementById('next-draw-date').textContent = `${month}ì›” ${date}ì¼ (í† ) ì˜¤í›„ 8:45`;
}

fetchJackpot();
calcNextDraw();

// ===================== CERT =====================
localStorage.removeItem('lottoCert');
// Firestoreì—ì„œ ì¸ì¦ ë¶ˆëŸ¬ì˜¤ê¸° (í˜ì´ì§€ ë¡œë“œì‹œ)
async function loadCertsOnInit() {
  if (!window.fbDb || !window.fbFunctions) {
    setTimeout(loadCertsOnInit, 1000);
    return;
  }
  try {
    const { collection, getDocs, orderBy, query } = window.fbFunctions;
    const q = query(collection(window.fbDb, 'certs'), orderBy('createdAt', 'desc'));
    const snap = await getDocs(q);
    if (!snap.empty) {
      certList = snap.docs.map(d => ({...d.data(), id: d.id}));
      localStorage.setItem('lottoCert', JSON.stringify(certList));
      renderCert();
    }
  } catch(e) {}
}
setTimeout(loadCertsOnInit, 1500);

let certList = JSON.parse(localStorage.getItem('lottoCert') || 'null');
if (!certList) {
  certList = [
    { grade: '5', nickname: 'ë¶€ì‚°ë³µë©ì´', message: '5ë“±ì´ì§€ë§Œ ë„ˆë¬´ ê¸°ë»ìš”!! ì²˜ìŒ ë‹¹ì²¨ëì–´ìš”', date: '2026.02.21', likes: 12 },
    { grade: '3', nickname: 'ëŒ€êµ¬ë³µê¶Œì™•', message: '3ë“± ë‹¹ì²¨!! 150ë§Œì› ã„·ã„· ë¡œë˜ë³µë©ì´ ìµœê³ !!', date: '2026.02.14', likes: 47 },
    { grade: '4', nickname: 'ì¸ì²œí–‰ìš´ì•„', message: '4ë“± 5ë§Œì›!! ì¹˜í‚¨ ì‚¬ë¨¹ê² ìŠµë‹ˆë‹¤ ã…‹ã…‹', date: '2026.02.14', likes: 8 },
    { grade: '5', nickname: 'ê°•ë‚¨ëŸ­í‚¤', message: 'ë¡œë˜ë³µë©ì´ ë²ˆí˜¸ ë¯¿ê³  ìƒ€ë”ë‹ˆ 5ë“± ëì–´ìš”!', date: '2026.02.14', likes: 15 },
    { grade: '5', nickname: 'ì œì£¼ë„ë¯¼', message: '5ì²œì›ì´ì§€ë§Œ ê¸°ë¶„ì€ 27ì–µ ã…‹ã…‹ã…‹ ë³µë©ì´ í™”ì´íŒ…!', date: '2026.02.07', likes: 6 },
  ];
  localStorage.setItem('lottoCert', JSON.stringify(certList));
}

async function submitCert() {
  const grade = document.getElementById('cert-grade').value;
  const nickname = document.getElementById('cert-nickname').value.trim();
  const message = document.getElementById('cert-message').value.trim();
  const photoInput = document.getElementById('cert-photo');
  if (!grade) { alert('ë“±ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
  if (!nickname) { alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }

  async function saveEntry(photoData) {
    const certData = {
      grade, nickname, message,
      date: new Date().toLocaleDateString('ko-KR'),
      likes: 0,
      photo: photoData || null,
      createdAt: new Date().toISOString()
    };

    // Firestoreì— ì €ì¥
    if (window.fbDb && window.fbFunctions) {
      try {
        const { collection, addDoc } = window.fbFunctions;
        const docRef = await addDoc(collection(window.fbDb, 'certs'), certData);
        certData.id = docRef.id;
      } catch(e) { console.log('Firestore ì €ì¥ ì‹¤íŒ¨', e); }
    }

    certList.unshift(certData);
    localStorage.setItem('lottoCert', JSON.stringify(certList));
    document.getElementById('cert-grade').value = '';
    document.getElementById('cert-nickname').value = '';
    document.getElementById('cert-message').value = '';
    document.getElementById('cert-photo').value = '';
    document.getElementById('cert-photo-preview').style.display = 'none';
    document.querySelector('.cert-photo-text').innerHTML = '<strong>ë‹¹ì²¨ ì¸ì¦ìƒ· ì˜¬ë¦¬ê¸°</strong> (ì„ íƒì‚¬í•­)<br>ë‹¹ì²¨ í™”ë©´ ìº¡ì²˜ë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”!';
    renderCert();
    if (grade === '1') alert('ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤!! 1ë“±!! ê´€ë¦¬ìì—ê²Œ ì¸ì¦ìƒ·ì„ ë³´ë‚´ì£¼ì‹œë©´ ì˜êµ¬ ë¬´ë£Œ í˜œíƒì„ ë“œë ¤ìš”!');
    else alert('âœ… ì¸ì¦ì´ ë“±ë¡ëì–´ìš”! ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ€');
  }

  if (photoInput.files && photoInput.files[0]) {
    const reader = new FileReader();
    reader.onload = e => saveEntry(e.target.result);
    reader.readAsDataURL(photoInput.files[0]);
  } else {
    saveEntry(null);
  }
}

async function toggleLike(idx) {
  certList[idx].likes = (certList[idx].likes || 0) + 1;

  // Firestore ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸
  if (window.fbDb && window.fbFunctions && certList[idx].id) {
    try {
      const { doc, updateDoc, increment } = window.fbFunctions;
      await updateDoc(doc(window.fbDb, 'certs', certList[idx].id), { likes: increment(1) });
    } catch(e) {}
  }

  localStorage.setItem('lottoCert', JSON.stringify(certList));
  renderCert();
}

function gradeLabel(g) {
  return { '1':'ğŸ‘‘ 1ë“±', '2':'ğŸ¥ˆ 2ë“±', '3':'ğŸ¥‰ 3ë“±', '4':'4ë“±', '5':'5ë“±' }[g] || g+'ë“±';
}

function buildCertItem(c, idx) {
  const cid = c.id || String(idx);
  let commentsHtml = '';
  if (c.comments && c.comments.length > 0) {
    commentsHtml = c.comments.map(function(cm) {
      return '<div class="comment-item"><span class="comment-nick">' + cm.nick + '</span><span>' + cm.text + '</span></div>';
    }).join('');
  } else {
    commentsHtml = '<div style="font-size:11px;color:#666;padding:4px 0;">ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
  }
  var html = '';
  html += '<div class="cert-item ' + (c.grade==='1' ? 'grade-1-item' : '') + '">';
  html += '<div class="cert-item-header"><div class="cert-item-left">';
  html += '<span class="cert-grade-badge badge-' + c.grade + '">' + gradeLabel(c.grade) + '</span>';
  html += '<span class="cert-nickname">' + c.nickname + '</span></div>';
  html += '<span class="cert-date">' + c.date + '</span></div>';
  if (c.message) html += '<div class="cert-message">&quot;' + c.message + '&quot;</div>';
  html += '<div style="margin-top:10px;display:flex;align-items:center;gap:8px;">';
  html += '<button class="like-btn" onclick="toggleLike(' + idx + ')">ğŸ‘ ' + (c.likes||0) + '</button>';
  html += '<button class="comment-toggle" onclick="toggleCommentBox(\'' + cid + '\')">ğŸ’¬ ëŒ“ê¸€ ' + (c.comments ? c.comments.length : 0) + '</button>';
  html += '</div>';
  html += '<div id="comment-box-' + cid + '" style="display:none">';
  html += '<div class="comment-section">' + commentsHtml + '</div>';
  html += '<div class="comment-input-row">';
  html += '<input class="comment-input" id="cnick-' + cid + '" placeholder="ë‹‰ë„¤ì„">';
  html += '<input class="comment-input" id="ctext-' + cid + '" placeholder="ëŒ“ê¸€ ë‚´ìš©">';
  html += '<button class="comment-btn" onclick="submitComment(\'' + cid + '\',' + idx + ')">ë“±ë¡</button>';
  html += '</div></div></div>';
  return html;
}

function renderCert() {
  const list = document.getElementById('cert-list');
  const countEl = document.getElementById('cert-count');
  const hallCard = document.getElementById('hall-of-fame-card');
  const hall = document.getElementById('hall-of-fame');
  countEl.textContent = 'ì´ ' + certList.length + 'ê±´';
  const firstPrize = certList.filter(c => c.grade === '1');
  if (firstPrize.length > 0) {
    hallCard.style.display = 'block';
    hall.innerHTML = firstPrize.map(c => '<div class="hall-item"><div class="hall-crown">ğŸ‘‘</div><div><div class="hall-name">'+c.nickname+'</div><div class="hall-date">'+c.date+'</div>'+(c.message?'<div class="hall-msg">"'+c.message+'"</div>':'')+'</div></div>').join('');
  }
  if (certList.length === 0) {
    list.innerHTML = '<div class="cert-empty"><div class="cert-empty-icon">ğŸ€</div><div>ì•„ì§ ì¸ì¦ì´ ì—†ì–´ìš”!<br>ì²« ë²ˆì§¸ ë‹¹ì²¨ìê°€ ë˜ì–´ë³´ì„¸ìš”!</div></div>';
    return;
  }
  list.innerHTML = certList.map((c, idx) => buildCertItem(c, idx)
  ).join('');
}
renderCert();


// ===================== PHOTO =====================
function previewPhoto(input) {
  const preview = document.getElementById('cert-photo-preview');
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = e => {
      preview.src = e.target.result;
      preview.style.display = 'block';
      // Change upload area text
      document.querySelector('.cert-photo-text').innerHTML = '<strong style="color:var(--green)">âœ… ì‚¬ì§„ì´ ì„ íƒëì–´ìš”!</strong><br>ë‹¤ë¥¸ ì‚¬ì§„ìœ¼ë¡œ ë°”ê¾¸ë ¤ë©´ í´ë¦­í•˜ì„¸ìš”';
    };
    reader.readAsDataURL(input.files[0]);
  }
}

function openPhotoModal(src) {
  document.getElementById('photo-modal-img').src = src;
  document.getElementById('photo-modal').classList.add('open');
}

function closePhotoModal() {
  document.getElementById('photo-modal').classList.remove('open');
}

// Close modal on background click
document.addEventListener('click', e => {
  if (e.target.id === 'photo-modal') closePhotoModal();
});

</script>

<div class="photo-modal" id="photo-modal">
  <button class="photo-modal-close" onclick="closePhotoModal()">Ã—</button>
  <img id="photo-modal-img" src="" alt="ì¸ì¦ì‚¬ì§„">
</div>

<div id="pwa-banner" style="display:none;position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#FFD700,#FF6B35);border-radius:16px;padding:14px 24px;z-index:9999;box-shadow:0 8px 32px rgba(0,0,0,0.4);width:90%;max-width:400px;">
  <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
    <div>
      <div style="font-size:14px;font-weight:900;color:#0A0A1A;">ğŸ“± ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°</div>
      <div style="font-size:11px;color:rgba(0,0,0,0.7);margin-top:2px;">í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ë©´ ì•±ì²˜ëŸ¼ ì‚¬ìš©í•´ìš”!</div>
    </div>
    <div style="display:flex;gap:8px;">
      <button onclick="installPWA()" style="background:#0A0A1A;color:#FFD700;border:none;border-radius:10px;padding:8px 16px;font-size:12px;font-weight:900;cursor:pointer;">ì„¤ì¹˜</button>
      <button onclick="closePWA()" style="background:rgba(0,0,0,0.2);color:#0A0A1A;border:none;border-radius:10px;padding:8px 12px;font-size:12px;cursor:pointer;">âœ•</button>
    </div>
  </div>
</div>

<script>
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('pwa-banner').style.display = 'block';
});

function installPWA() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(choice => {
      if (choice.outcome === 'accepted') {
        document.getElementById('pwa-banner').style.display = 'none';
      }
      deferredPrompt = null;
    });
  }
}

function closePWA() {
  document.getElementById('pwa-banner').style.display = 'none';
}

if ('serviceWorker' in navigator) {
  // ê¸°ì¡´ ì„œë¹„ìŠ¤ì›Œì»¤ ì „ë¶€ ì œê±° (ìºì‹œ ë¬¸ì œ í•´ê²°)
  navigator.serviceWorker.getRegistrations().then(regs => {
    regs.forEach(reg => reg.unregister());
  });
}


// ===================== COMMENTS =====================
function toggleCommentBox(certId) {
  const box = document.getElementById('comment-box-' + certId);
  if (box) box.style.display = box.style.display === 'none' ? 'block' : 'none';
}

async function submitComment(certId, idx) {
  const nick = document.getElementById('cnick-' + certId)?.value.trim();
  const text = document.getElementById('ctext-' + certId)?.value.trim();
  if (!nick) { alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
  if (!text) { alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }

  const comment = { nick, text, date: new Date().toLocaleDateString('ko-KR') };

  if (!certList[idx].comments) certList[idx].comments = [];
  certList[idx].comments.push(comment);

  // Firestore ì—…ë°ì´íŠ¸
  if (window.fbDb && window.fbFunctions && certList[idx].id) {
    try {
      const { doc, updateDoc } = window.fbFunctions;
      await updateDoc(doc(window.fbDb, 'certs', certList[idx].id), {
        comments: certList[idx].comments
      });
    } catch(e) {}
  }

  localStorage.setItem('lottoCert', JSON.stringify(certList));
  renderCert();
  // ëŒ“ê¸€ì°½ ë‹¤ì‹œ ì—´ê¸°
  setTimeout(() => {
    const box = document.getElementById('comment-box-' + certId);
    if (box) box.style.display = 'block';
  }, 50);
}

// ===================== AUTH UI =====================
function showAuthModal() {
  document.getElementById('auth-modal').style.display = 'flex';
}
function closeAuthModal() {
  document.getElementById('auth-modal').style.display = 'none';
  document.getElementById('auth-error').textContent = '';
}
function showMyPage() {
  alert('ë‚´ ì •ë³´ í˜ì´ì§€ëŠ” ì¤€ë¹„ ì¤‘ì´ì—ìš”!');
}
function switchAuthTab(tab) {
  const isLogin = tab === 'login';
  document.getElementById('tab-login').style.background = isLogin ? '#FFD700' : 'transparent';
  document.getElementById('tab-login').style.color = isLogin ? '#000' : '#aaa';
  document.getElementById('tab-signup').style.background = isLogin ? 'transparent' : '#FFD700';
  document.getElementById('tab-signup').style.color = isLogin ? '#aaa' : '#000';
  document.getElementById('nick-field').style.display = isLogin ? 'none' : 'block';
  document.getElementById('auth-submit-btn').textContent = isLogin ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…';
  document.getElementById('auth-submit-btn').onclick = () => doEmailAuth(isLogin);
  document.getElementById('auth-error').textContent = '';
}
// ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ì‹œ ë‹«ê¸°
document.getElementById('auth-modal').addEventListener('click', function(e) {
  if (e.target === this) closeAuthModal();
});
</script>
</body>
</html>
